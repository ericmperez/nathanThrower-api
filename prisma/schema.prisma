generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String?  // Nullable for OAuth users
  name      String
  firstName   String?
  lastName    String?
  dateOfBirth DateTime?  // Store DOB instead of age - age is calculated
  age         Int?       // @deprecated - use dateOfBirth instead, kept for backwards compatibility
  language    String?    @default("en") // en, es
  role          String   @default("user") // user, admin, nathan, dad, coach, player
  goals         String[] @default([]) // Training goals: velo, command, injury_prevention, mechanics, endurance
  handedness    String?  // R (right), L (left)
  endGoal       String?  // Long-term goal: play_college, go_pro, improve_for_fun, make_team, stay_healthy
  currentVelocity Int?   // Current velocity in MPH
  targetVelocity  Int?   // One-year target velocity in MPH
  profilePicture String?  // URL to profile picture in cloud storage
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Authentication & Security fields
  emailVerified           Boolean?  @default(false)
  emailVerificationToken  String?
  emailVerificationExpiry DateTime?
  passwordResetToken      String?
  passwordResetExpiry     DateTime?
  failedLoginAttempts     Int       @default(0)
  lockedUntil             DateTime?

  // OAuth fields
  oauthProvider String?  // 'apple', 'google', null for email/password
  oauthId       String?  // Provider's user ID (e.g., Apple sub, Google sub)
  
  @@index([oauthProvider, oauthId])

  // Push notification tokens
  pushTokens PushToken[]

  analyses      Analysis[]
  purchases     Purchase[]
  refreshTokens RefreshToken[]
  subscription  Subscription?
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  
  // Referral relations
  referralCode    ReferralCode?  // User's own referral code
  referralsMade   Referral[]     @relation("ReferralsMade") // People this user referred
  referredBy      Referral?      @relation("ReferredBy")    // Who referred this user

  // Pitch counting
  pitchCountSessions PitchCountSession[]

  // Audit logs
  authAuditLogs AuthAuditLog[]

  // Workout & Streaks
  workoutLogs WorkoutLog[]
  streak      UserStreak?

  // Training Programs
  programEnrollments UserProgramEnrollment[]

  // Real-time Chat System
  createdChats        Chat[]               @relation("ChatCreator")
  chatParticipants    ChatParticipant[]
  sentChatMessages    ChatMessage[]        @relation("ChatMessageSender")
  chatMessageReceipts ChatMessageReceipt[]
  presence            UserPresence?

  @@index([email])
  @@index([emailVerificationToken])
  @@index([passwordResetToken])
}

model Subscription {
  id              String    @id @default(cuid())
  userId          String    @unique
  tier            String    @default("free") // free, premium, pro, elite
  plan            String    // weekly, quarterly, monthly, yearly
  status          String    @default("active") // active, cancelled, expired
  provider        String    // stripe, apple, google, mock
  providerSubId   String?   // External subscription ID
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  cancelAtPeriodEnd  Boolean  @default(false)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([tier])
  @@index([currentPeriodEnd])
}

model PushToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique // ExponentPushToken[...]
  deviceId  String?  // Optional device identifier
  platform  String   @default("ios") // ios, android
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model Message {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  content    String   @db.Text
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())

  // Video attachment fields (optional)
  videoUrl   String?  // Public URL for video
  videoKey   String?  // S3 key for video
  hasVideo   Boolean  @default(false)

  // Image attachment fields (optional)
  imageUrl   String?  // Public URL for image
  imageKey   String?  // S3 key for image
  hasImage   Boolean  @default(false)

  // Thumbnail for video preview
  thumbnailUrl String?

  sender    User              @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver  User              @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  reactions MessageReaction[]
  bookmarks MessageBookmark[]

  @@index([senderId, createdAt])
  @@index([receiverId, createdAt])
  @@index([receiverId, isRead])
}

model MessageReaction {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  emoji     String   // The emoji character (e.g., "üî•", "üëç", "‚ù§Ô∏è", "üí™")
  createdAt DateTime @default(now())

  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji]) // One reaction per emoji per user per message
  @@index([messageId])
  @@index([userId])
}

model MessageBookmark {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  createdAt DateTime @default(now())

  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId]) // One bookmark per user per message
  @@index([userId])
  @@index([messageId])
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  deviceId  String?  // Optional device identifier
  isRevoked Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model VideoAsset {
  id           String   @id @default(cuid())
  key          String   @unique
  url          String
  thumbnailUrl String?
  filename     String
  sizeBytes    Int
  duration     Int? // seconds
  createdAt    DateTime @default(now())

  analysis Analysis?

  @@index([key])
}

model Analysis {
  id            String   @id @default(cuid())
  userId        String
  videoAssetId  String   @unique
  pitchType     String // FB, CB, CH, SL
  handedness    String // R, L
  goal          String // velo, command, injury_prevention
  status        String   @default("queued") // queued, processing, completed, failed
  errorMessage  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  videoAsset VideoAsset  @relation(fields: [videoAssetId], references: [id], onDelete: Cascade)
  metrics    AnalysisMetrics?
  report     CoachingReport?

  @@index([userId, createdAt])
  @@index([status])
}

model AnalysisMetrics {
  id         String   @id @default(cuid())
  analysisId String   @unique
  data       Json // stores the metrics object
  createdAt  DateTime @default(now())

  analysis Analysis @relation(fields: [analysisId], references: [id], onDelete: Cascade)
}

model CoachingReport {
  id         String   @id @default(cuid())
  analysisId String   @unique
  data       Json // stores the full coaching report
  createdAt  DateTime @default(now())

  analysis Analysis @relation(fields: [analysisId], references: [id], onDelete: Cascade)
}

model Course {
  id           String   @id @default(cuid())
  title        String
  description  String   @db.Text
  thumbnailUrl String?
  price        Int // cents
  isPublished  Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  lessons   Lesson[]
  purchases Purchase[]

  @@index([isPublished])
}

model Lesson {
  id          String   @id @default(cuid())
  courseId    String
  title       String
  description String   @db.Text
  videoUrl    String?
  duration    Int // seconds
  order       Int
  isFree      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId, order])
}

model Purchase {
  id         String   @id @default(cuid())
  userId     String
  courseId   String
  status     String // pending, completed, refunded
  provider   String // stripe, apple, google, mock
  receiptRef String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
}

model Drill {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  videoUrl    String?
  category    String // warmup, mechanics, recovery, etc
  tags        String[] // for searching
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
}

// ==========================================
// REFERRAL SYSTEM
// ==========================================

model ReferralCode {
  id        String   @id @default(cuid())
  userId    String   @unique
  code      String   @unique // e.g., "NATHAN25" or auto-generated
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  referrals Referral[]

  @@index([code])
}

model Referral {
  id              String   @id @default(cuid())
  referralCodeId  String   // The code that was used
  referrerId      String   // User who owns the code (the referrer)
  referredId      String   @unique // New user who signed up with the code
  status          String   @default("pending") // pending, active, cancelled
  commissionRate  Float    @default(0.20) // 20% commission
  freeMonthsGiven Int      @default(0) // Months credited to referrer
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  referralCode ReferralCode @relation(fields: [referralCodeId], references: [id])
  referrer     User         @relation("ReferralsMade", fields: [referrerId], references: [id], onDelete: Cascade)
  referred     User         @relation("ReferredBy", fields: [referredId], references: [id], onDelete: Cascade)
  commissions  Commission[]

  @@index([referrerId])
  @@index([status])
}

model Commission {
  id          String    @id @default(cuid())
  referralId  String
  amount      Int       // cents
  currency    String    @default("USD")
  status      String    @default("pending") // pending, approved, paid, rejected
  description String?   // e.g., "Pro Monthly - December 2024"
  paidAt      DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  referral Referral @relation(fields: [referralId], references: [id], onDelete: Cascade)

  @@index([referralId])
  @@index([status])
}

// ==========================================
// PITCH COUNTER SYSTEM
// ==========================================

model PitchCountSession {
  id          String   @id @default(cuid())
  userId      String
  sessionType String   // "game" or "bullpen"
  age         Int      // Player's age at time of session
  date        DateTime @default(now())
  notes       String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user    User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  pitches PitchCountEntry[]

  @@index([userId, date])
  @@index([userId, createdAt])
}

model PitchCountEntry {
  id        String   @id @default(cuid())
  sessionId String
  pitchType String   // "fastball", "curveball", "slider", "changeup", etc.
  result    String   // "strike", "ball", "foul", "hit", "out"
  order     Int      // Order in the session
  createdAt DateTime @default(now())

  session PitchCountSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId, order])
}

model PitchCountLimit {
  id              String   @id @default(cuid())
  minAge          Int      // Minimum age for this limit
  maxAge          Int      // Maximum age for this limit (inclusive)
  sessionType     String   // "game" or "bullpen"
  maxPitches      Int      // Maximum pitches allowed
  warningThreshold Int     // Alert when approaching (e.g., 80% of max)
  restDaysAfter   Int      // Rest days required after reaching max
  isActive        Boolean  @default(true)
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([minAge, maxAge, sessionType])
  @@index([isActive])
}

model RestDayGuideline {
  id            String   @id @default(cuid())
  minAge        Int      // Minimum age for this guideline
  maxAge        Int      // Maximum age for this guideline (inclusive)
  pitchCountMin Int      // Minimum pitch count for this guideline
  pitchCountMax Int?     // Maximum pitch count (null means unlimited)
  restDays      Int      // Rest days required
  isActive      Boolean  @default(true)
  notes         String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([minAge, maxAge])
  @@index([isActive])
}

// ==========================================
// WORKOUT ACTIVITY & STREAKS
// ==========================================

model WorkoutLog {
  id          String   @id @default(cuid())
  userId      String
  courseId    String?  // Optional - can be null for general activity
  lessonId    String?  // Optional - specific lesson completed
  activityType String  // "lesson_complete", "course_complete", "drill", "pitch_session"
  date        DateTime @default(now()) // The date of the activity
  duration    Int?     // Duration in seconds (optional)
  notes       String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date, courseId, lessonId, activityType]) // Prevent duplicate logs for same activity
  @@index([userId, date])
  @@index([userId, createdAt])
}

model UserStreak {
  id              String   @id @default(cuid())
  userId          String   @unique
  currentStreak   Int      @default(0)
  longestStreak   Int      @default(0)
  lastActivityDate DateTime?
  streakStartDate DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ==========================================
// AUTHENTICATION AUDIT LOG
// ==========================================

model AuthAuditLog {
  id        String   @id @default(cuid())
  userId    String
  action    String   // login, logout, password_change, password_reset, email_verification, failed_login, account_locked
  ipAddress String?
  userAgent String?
  metadata  Json?    // Additional context (deviceId, etc.)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([action, createdAt])
  @@index([createdAt])
}

// ==========================================
// TRAINING PROGRAMS
// ==========================================

model TrainingProgram {
  id            String   @id @default(cuid())
  title         String
  description   String   @db.Text
  category      String   // velocity, mechanics, injury_prevention, endurance
  difficulty    String   // beginner, intermediate, advanced
  durationWeeks Int      @default(4)
  thumbnailUrl  String?
  isActive      Boolean  @default(true)
  isPremium     Boolean  @default(true) // Requires Premium+ subscription
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  weeks       TrainingProgramWeek[]
  enrollments UserProgramEnrollment[]

  @@index([category])
  @@index([isActive])
  @@index([isPremium])
}

model TrainingProgramWeek {
  id          String   @id @default(cuid())
  programId   String
  weekNumber  Int
  title       String
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  program TrainingProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
  days    TrainingProgramDay[]

  @@unique([programId, weekNumber])
  @@index([programId])
}

model TrainingProgramDay {
  id        String   @id @default(cuid())
  weekId    String
  dayNumber Int      // 1-7
  title     String
  drillIds  String[] // Array of Drill IDs
  notes     String?  @db.Text
  restDay   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  week TrainingProgramWeek @relation(fields: [weekId], references: [id], onDelete: Cascade)

  @@unique([weekId, dayNumber])
  @@index([weekId])
}

model UserProgramEnrollment {
  id            String   @id @default(cuid())
  userId        String
  programId     String
  startDate     DateTime @default(now())
  currentWeek   Int      @default(1)
  currentDay    Int      @default(1)
  status        String   @default("active") // active, completed, paused, cancelled
  completedDays String[] // Array of completed day IDs
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user    User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  program TrainingProgram @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@unique([userId, programId])
  @@index([userId, status])
  @@index([programId])
}

// ==========================================
// REAL-TIME CHAT SYSTEM
// ==========================================

enum ChatType {
  DIRECT
  GROUP
}

enum ChatMessageStatus {
  SENT
  DELIVERED
  READ
}

model Chat {
  id          String    @id @default(cuid())
  type        ChatType  @default(DIRECT)
  name        String?   // For group chats
  createdById String    @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  createdBy    User              @relation("ChatCreator", fields: [createdById], references: [id])
  participants ChatParticipant[]
  messages     ChatMessage[]

  @@map("chats")
}

model ChatParticipant {
  id         String    @id @default(cuid())
  chatId     String    @map("chat_id")
  userId     String    @map("user_id")
  joinedAt   DateTime  @default(now()) @map("joined_at")
  leftAt     DateTime? @map("left_at")
  lastReadAt DateTime? @map("last_read_at")
  isAdmin    Boolean   @default(false) @map("is_admin")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")

  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([chatId, userId])
  @@index([userId])
  @@map("chat_participants")
}

model ChatMessage {
  id        String            @id @default(cuid())
  chatId    String            @map("chat_id")
  senderId  String            @map("sender_id")
  content   String            @db.Text
  status    ChatMessageStatus @default(SENT)
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")
  deletedAt DateTime?         @map("deleted_at")

  chat     Chat                 @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender   User                 @relation("ChatMessageSender", fields: [senderId], references: [id])
  receipts ChatMessageReceipt[]

  @@index([chatId, createdAt])
  @@index([senderId])
  @@map("chat_messages")
}

model ChatMessageReceipt {
  id        String   @id @default(cuid())
  messageId String   @map("message_id")
  userId    String   @map("user_id")
  readAt    DateTime @default(now()) @map("read_at")
  createdAt DateTime @default(now()) @map("created_at")

  message ChatMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user    User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@map("chat_message_receipts")
}

model UserPresence {
  id         String   @id @default(cuid())
  userId     String   @unique @map("user_id")
  isOnline   Boolean  @default(false) @map("is_online")
  lastSeenAt DateTime @default(now()) @map("last_seen_at")
  socketId   String?  @map("socket_id")
  updatedAt  DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_presences")
}

// ==========================================
// PAWN LOAN SYSTEM
// ==========================================

enum LoanStatus {
  ACTIVE
  REDEEMED
  FORFEITED
  EXTENDED
}

enum PaymentMethod {
  CASH
  CARD
  CHECK
}

enum CycleOption {
  A    // New cycle - payment covers X days, next payment due in X days
  B    // Keep original due date, remaining balance tracked
}

model PawnLoan {
  id                    String      @id @default(cuid())
  customerId            String      @map("customer_id")

  // Item details
  itemDescription       String      @map("item_description") @db.Text
  itemCategory          String      @map("item_category")
  serialNumber          String?     @map("serial_number")

  // Loan amounts (all in cents)
  principal             Int         // Amount loaned
  monthlyInterestRate   Float       @map("monthly_interest_rate")  // e.g., 0.20 for 20%
  storageFee            Int         @default(0) @map("storage_fee")

  // Loan dates
  startDate             DateTime    @default(now()) @map("start_date")
  termEndDate           DateTime?   @map("term_end_date")  // startDate + 450 days (15 months)
  nextPaymentDueDate    DateTime    @map("next_payment_due_date")
  currentCycleStart     DateTime?   @map("current_cycle_start")

  // First month tracking
  firstMonthFeeOwed     Int         @default(0) @map("first_month_fee_owed")  // Remaining first month balance (cents)
  firstMonthFeePaid     Boolean     @default(false) @map("first_month_fee_paid")

  // Principal tracking (for principal-only period)
  principalRemaining    Int         @map("principal_remaining")  // Track principal reduction

  // Status
  status                LoanStatus  @default(ACTIVE)
  redeemedAt            DateTime?   @map("redeemed_at")
  forfeitedAt           DateTime?   @map("forfeited_at")

  createdAt             DateTime    @default(now()) @map("created_at")
  updatedAt             DateTime    @updatedAt @map("updated_at")

  // Relations
  payments              LoanPayment[]

  @@index([customerId])
  @@index([status])
  @@index([nextPaymentDueDate])
  @@map("pawn_loans")
}

model LoanPayment {
  id              String        @id @default(cuid())
  loanId          String        @map("loan_id")

  // Payment details (all amounts in cents)
  amount          Int           // Amount paid
  paymentMethod   PaymentMethod @map("payment_method")

  // 15-month tracking
  daysCovered     Int           @default(0) @map("days_covered")
  cycleOption     CycleOption?  @map("cycle_option")  // "A" or "B" for partial payments
  newDueDate      DateTime?     @map("new_due_date")  // Set if Option A chosen
  remainingOwed   Int?          @map("remaining_owed")  // Set if Option B chosen (cents)

  // What the payment applied to
  appliedToFirstMonth   Int     @default(0) @map("applied_to_first_month")  // cents
  appliedToInterest     Int     @default(0) @map("applied_to_interest")     // cents
  appliedToPrincipal    Int     @default(0) @map("applied_to_principal")    // cents

  // Payment context
  loanDayAtPayment      Int     @map("loan_day_at_payment")  // Which day of the loan (1-450+)
  periodAtPayment       String  @map("period_at_payment")    // "first_month", "interest_only", "principal_only"

  notes           String?       @db.Text
  createdAt       DateTime      @default(now()) @map("created_at")

  // Relations
  loan            PawnLoan      @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@index([loanId])
  @@index([createdAt])
  @@map("loan_payments")
}

model SystemSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String   @db.Text  // JSON-encoded value
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("system_settings")
}

// ==========================================
// AUDIT LOG SYSTEM (General Purpose)
// ==========================================

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?  // Nullable for system actions or failed logins
  action     String   // LOGIN_SUCCESS, LOGIN_FAILURE, CREATE, UPDATE, DELETE, etc.
  entityType String?  // User, PawnLoan, LoanPayment, etc.
  entityId   String?  // ID of the affected entity
  oldValue   Json?    // Previous state (for updates/deletes)
  newValue   Json?    // New state (for creates/updates)
  ipAddress  String?
  userAgent  String?
  metadata   Json?    // Additional context
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

// ==========================================
// CONTENT (TIP OF THE WEEK, etc.)
// ==========================================

model TipOfTheWeek {
  id           String    @id @default(cuid())
  title        String
  description  String?   @db.Text
  videoUrl     String    // URL to video on CDN
  thumbnailUrl String?   // Optional thumbnail image
  publishedAt  DateTime  @default(now())
  expiresAt    DateTime? // Optional expiration date
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([isActive, publishedAt])
  @@index([expiresAt])
}
